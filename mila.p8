pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
--variables
function _init()
  player={
    sp=1,
    x=59,
    y=59,
    w=8,
    h=8,
    flp=false,
    dx=0,
    dy=0,
    max_dx=2,
    max_dy=3,
    acc=0.5,
    boost=4,
    anim=0,
    running=false,
    jumping=false,
    falling=false,
    sliding=false,
    landed=false,
  }
  
  gravity=0.3
  friction=0.85
end



-->8
--update and draw

function _update()
  player_update()
  player_animate()
  
end

function _draw()
  cls()
  map(0,0)
  spr(player.sp,player.x,player.y,1,1,player.flp)
end
-->8
--collisions

function collide_map(obj,aim,flag)
 --obj = table x,y,h,w
 --aim = left,right,up,down
 
 local x=obj.x local y=obj.y
 local h=obj.h local w=obj.w
 
 local x1=0 local y1=0
 local x2=0 local y2=0
 
 if aim=="left" then
   x1=x-1  y1=y
   x2=x    y2=y+h-1
   
 elseif aim=="right" then
   x1=x+w   y1=y
   x2=x+w+1 y2=y+h-1
   
 elseif aim=="up" then
   x1=x+1   y1=y-1
   x2=x+w-1 y2=y
 
 elseif aim=="down" then
   x1=x     y1=y+h
   x2=x+w   y2=y+h
    
 end
 
 --pixels to tiles
 x1/=8    y1/=8
 x2/=8    y2/=8
 
 if fget(mget(x1,y1), flag)
 or fget(mget(x1,y2), flag)
 or fget(mget(x2,y1), flag)
 or fget(mget(x2,y2), flag) then
   return true 
 else
   return false
 end
end
-->8
--player
function player_update()
  --physics
  player.dy+=gravity
  player.dx*=friction
  
  --controls
  if btn(⬅️) then
    player.dx-=player.acc
    player.running=true
    player.flp=true
  end
  
  if btn(➡️) then
    player.dx+=player.acc  -- fixed: was -=
    player.running=true
    player.flp=false  -- fixed: was true
  end
  
  --slide
  if player.running
  and not btn(⬅️)
  and not btn(➡️)
  and not player.falling
  and not player.jumping then 
    player.running=false
    player.sliding=false
  end
  
  --jump
  if btnp(❎)
  and player.landed then
     player.dy-=player.boost
     player.landed=false
  end
  
  --check collision up and down
  if player.dy>0 then
    player.falling=true
    player.landed=false
    player.jumping=false
    
    if collide_map(player,"down",0) then
      player.landed=true
      player.falling=false
      player.dy=0
      player.y-=(player.y+player.h)%8
    end
    
  elseif player.dy<0 then
  player.jumping=true
  if collide_map(player,"up",1) then
    player.dy=0
    end
  end
  
  --check collisions left and right
 if player.dx<0 then
  if collide_map(player,"left",1) then  -- fixed: added 'then'
    player.dx=0
  end
 elseif player.dx>0 then
   if collide_map(player,"right",1) then
     player.dx=0
   end
 end
 
 --stop sliding
 if player.sliding then
   if abs(player.dx)<.2  -- note: assuming 'rbs' was meant to be 'abs'
   or player.running then
     player.dx=0
     player.sliding=false
   end
 end
  player.x+=player.dx
  player.y+=player.dy
end

function player_animate()
  if player.jumping then
    player.sp=7
  elseif player.falling then
    player.sp=8
  elseif player.sliding then
    player.sp=9
  elseif player.running then
    if time()-player.anim>.1 then
      player.anim=time()
      player.sp+=1
      if player.sp>6 then
        player.sp=3
      end
    end
  else --playeridle
    if time()-player.anim>.3 then
      player.anim=time()
      player.sp+=1
      if player.sp>2 then
        player.sp=1
      end
    end
  end
end
__gfx__
00000000044444400444444000444444004444444004444400444444000444444404444400000000000000000000000000000000000000000000000000000000
00000000444444404444444004044444000444440444444400044444404444440044444404444400000000000000000000000000000000000000000000000000
0070070004f7cfc004f7cfc0404f7cfc404ff7cf404f7cfc404ff7cf440ff7cf000ff7cf44444400000000000000000000000000000000000000000000000000
0007700040fffff040fffef0000fffef000ffffe000fffef000ffffe000ffffe000ffffe4f7cfc00000000000000000000000000000000000000000000000000
00077000000220000022220000f2220000f2220000f2220000f2220000022200000022200fffef00000000000000000000000000000000000000000000000000
00700700002222000f0220f00000220000002200000022000000220000f022000000220f002222f0000000000000000000000000000000000000000000000000
000000000f01d0f00001d00000110d000001d00000dd0100000d1000000d1000000001600f022d00000000000000000000000000000000000000000000000000
0000000000100d0000100d0000000d000001d00000000100000d100000d100000000001d000011dd000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11dd1111d111d1111d1111110000000000000000000ddddddddd0000000000000000000000000000000000000000000000000000000000000000000000000000
d111111d111111dd11d111d10000004aa0000000000dddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000
555555555555555555555555000000a840000000000dddd000000000000000000000000000000000000000000000000000000000000000000000000000000000
666566665666d566665666d500000aaaaa0000000dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66d5dd665d6665d66d5d6665000008aaaa00000000000000000000d0000000000000000000000000000000000000000000000000000000000000000000000000
5555555555555555555555550000a48aaaa000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000
666d56666566665d666566660000aaaaaaa00000dddddd000000d000000000000000000000000000000000000000000000000000000000000000000000000000
66d65dd6d5dd665666d5d66d000aaa888aaa0000dddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000
5555555555555555555555550009aa44aaa90000dddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000
6656666566665d6665666d5600499aaaaa494000dddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000
665d666566dd566665d666560044999999944000dd00d00000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555500444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
666656666566dd566665d6660000444444400000000000000ddddd00000000000000000000000000000000000000000000000000000000000000000000000000
66dd5d6665d6665d66d5666600000067600000000000000ddddddddd000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555500000067600000000000ddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555500000067600000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000067600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
84885884858888588485848858488588000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
848a58488584845888a58aa85888854a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88a8584885a88454484584a858848588000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8888588485488858888588485848458a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
58485588855848554845584855888558000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05552255522555225552255522555205000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002eee22e2ee2e5ee2ee2e2ee2eee200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00522262622252222622622226252600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002ee6eeeee2ee5ee52ee66eee6ee500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00522652255252222252226226525200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002e111111ee44444444ee511111e200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00221aaaa5224c4c64c4221aaac5e200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005e1aa4c52e4c46c4c45e5a4ca12500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002214c44125444444442214c4412200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002e544441e54c4cc4c4ee1c4441e200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0052544441224c4cc464221484c12200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00225484c1e544444444ee58cc41e500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0052184c41224c4c64c4621888812200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002e18c881ee464cc4c4e61848c1e600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00525c88c12244444444251888812200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002e555115ee44446554e2111115e200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005262625562444545a4252522252500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002e2eeee56e44444444ee2eeee2e200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00225522262244444444252525222500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005ee2eee2ee44444444edeee5eee200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0022d25d22224444444422dd22225200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005e5ee52dee44444444e5eeee5ee500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00525222d52244444444226222d5d200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002ee5ee2dee44444444ee5eeedee200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030300000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4848484848000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4848484800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4848484848480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4848484848486565000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4848484848000065000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4848484800000065000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5858580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0058000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0058000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0058808182834344000058585858585858000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0058909192935354000058585858585800000000005858000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5858a0a1a2a36364000058585858585858585858585858000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6558b0b1b2b37374585858585858586658585858585858000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041424041424041424041424041424058585858585800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5051525051515251515051505052505065586566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
